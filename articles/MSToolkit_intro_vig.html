<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MSToolkit">
<title>Introduction to MSToolkit • MSToolkit</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to MSToolkit">
<meta property="og:description" content="MSToolkit">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MSToolkit</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/MSToolkit_intro_vig.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/generate_data.html">generateData</a>
    <a class="dropdown-item" href="../articles/analyze_data.html">analyzeData</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Background Reading</h6>
    <a class="dropdown-item" href="../articles/simulation_overview.html">Simulation Overview</a>
    <a class="dropdown-item" href="../articles/references.html">References</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MikeKSmith/MSToolkit/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to MSToolkit</h1>
            
            <h4 data-toc-skip class="date">2024-02-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MikeKSmith/MSToolkit/blob/HEAD/vignettes/MSToolkit_intro_vig.Rmd" class="external-link"><code>vignettes/MSToolkit_intro_vig.Rmd</code></a></small>
      <div class="d-none name"><code>MSToolkit_intro_vig.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>MSToolkit</code> is an R package designed and built for Pfizer
by Mango Solutions originally, which is used for simulating data,
analysing this data and assessing operating characteristics of clinical
trials.</p>
<p><code>MSToolkit</code> comprises a suite of low-level functions which
are used to generate data and apply user-specified analysis functions or
SAS analysis code to the generated data. High level functions are
provided which wrap these functions together to perform the data
generation and analysis steps.</p>
<p>This purpose of this vignettes page is to help users understand how
to generate data for cases and analyse this simulated data.</p>
</div>
<div class="section level2">
<h2 id="illustration-of-generatedate-function-by-an-example">Illustration of <code>generateDate</code> function by an
example<a class="anchor" aria-label="anchor" href="#illustration-of-generatedate-function-by-an-example"></a>
</h2>
<p>The <code>generateData</code> function generates simulated data
replicates by controlling dosing, covariates, parameters, response,
missingness and interim. It takes a number of arguments which are passed
down to the various lower level functions to create sets of simulated
data.</p>
<p>The following inputs are used to generate <em>100</em> replicates of
<em>200</em> subjects split equally across the two treatment arms by
basic linear model.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Before we use the `generateDate` function, we need to library the `MSToolkit` package.</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MSToolkit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inputs the variables into the arguments</span></span>
<span></span>
<span><span class="fu"><a href="../reference/generateData.html">generateData</a></span><span class="op">(</span>replicateN <span class="op">=</span> <span class="fl">100</span>, </span>
<span>             subjects <span class="op">=</span> <span class="fl">200</span>, </span>
<span>             treatSubj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>             treatDoses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span>,  </span>
<span>             genParNames <span class="op">=</span> <span class="st">"ALPHA, BETA"</span>, </span>
<span>             genParMean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, </span>
<span>             genParVCov <span class="op">=</span> <span class="fl">0</span>,  </span>
<span>             respEqn <span class="op">=</span> <span class="st">"ALPHA+BETA*DOSE"</span>, </span>
<span>             respVCov <span class="op">=</span> <span class="fl">1</span>,  </span>
<span>             seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span></code></pre></div>
<p>The treatment doses are <em>0</em> and <em>100</em>. Parameters
<em>ALPHA</em> and <em>BETA</em> are generated where <em>ALPHA = 0</em>
and <em>BETA = 1</em>. The values of ALPHA and BETA will not change
between simulation replicates since <code>genParVCov = 0</code>. The
linear predictor (<code>respEqn</code>) calculates the response for each
treatment (dose) according to the equation <span class="math inline">\(ALPHA + BET A* DOSE\)</span>, in this case the
expected effect at each dose is the same as the dose level since ALPHA=0
and BETA=1. respVCov specifies the response variability / residual error
which will be added to the expected values generated through respEqn.
Here the residual variability equals to 1 so values from a
<em>N(0,1)</em> distribution will be generated for each response and
added to values from <code>respEqn</code>. The <code>seed</code> is set
to ensure reproducibility. By default MSToolkit assumes an additive
error structure, although this can be changed through settings in the
<code>generateData(...)</code> call.</p>
<p>Meanwhile, different distributions could be specified by
<code>respDist =</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/generateData.html">generateData</a></span><span class="op">(</span>replicateN <span class="op">=</span> <span class="fl">2</span>, </span>
<span>             subjects <span class="op">=</span> <span class="fl">200</span>, </span>
<span>             treatSubj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>             treatDoses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span>,  </span>
<span>             genParNames <span class="op">=</span> <span class="st">"ALPHA, BETA"</span>, </span>
<span>             genParMean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, </span>
<span>             genParVCov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, </span>
<span>             respEqn <span class="op">=</span> <span class="st">"ALPHA+BETA*DOSE"</span>,  </span>
<span>             respDist <span class="op">=</span> <span class="st">"Binary"</span><span class="op">)</span>    <span class="co"># Binomial distribution</span></span></code></pre></div>
<p>In this example we simulate data from a binomial distribution by
setting <code>respDist="Binary"</code>. The linear predictor is given by
<span class="math inline">\(log(\frac{p}{1-p}) = ALPHA +
BETA*DOSE\)</span>, so that the probability of a response equals to 1
increases with DOSE. The canonical inverse link functions are used to
convert between the linear predictor and the input to the response
distribution, for example the link for Binary data is <span class="math inline">\(\frac{exp( x )}{1 + exp( x )}\)</span>. Other link
functions can be specified by setting the argument
<code>respInvLink</code> which takes any R function. For example it is
possible to generate binary data from explicit probabilities by setting
<code>respDist = "Binary"</code> and <code>respInvLink = "NULL"</code>
to use the identity link.</p>
<p>Besides, the different outcome values could be generated by
specifying the linear predictor for the <code>respEqn</code> argument.
This should be a valid R expression or function. The expression can be
written directly in <code>generateData</code> or an R function defined
outside of <code>generateData</code> can be called. This function must
return a vector of equal length to the number of rows in the generated
data - one value per subject or one value per observation (TIME) within
each subject.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/generateData.html">generateData</a></span><span class="op">(</span>replicateN <span class="op">=</span> <span class="fl">100</span>, </span>
<span>             subjects <span class="op">=</span> <span class="fl">100</span>, </span>
<span>             treatSubj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>             treatDoses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>,  </span>
<span>             genParNames <span class="op">=</span> <span class="st">"E0,ED50,EMAX"</span>, </span>
<span>             genParMean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span>,<span class="fl">100</span><span class="op">)</span>, </span>
<span>             genParVCov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>,  </span>
<span>             respEqn <span class="op">=</span> <span class="st">"E0 + ((DOSE * EMAX)/(DOSE + ED50))"</span>,  </span>
<span>             respVCov <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>A basic Emax model is applied to generate <em>100</em> replicates of
<em>100</em> subjects split equally across the <em>5</em> treatment
arms. The treatment arms are <em>0</em>, <em>5</em>, <em>10</em>,
<em>50</em>, <em>100</em>. Three parameters are to be generated, and are
named <em>E0</em>, <em>ED50</em> and <em>EMAX</em>. These take the
values <em>0</em>, <em>50</em> and <em>100</em> respectively. The
variance-covariance matrix is set to <em>0</em> so again, these
parameters will be the same across all replicates. The linear predictor
is the standard 3-parameter Emax model. The variance of the response is
set to 100 so responses will be drawn from a Normal distribution with
mean given by the Emax model and variance <em>100</em>, for example
<code>respVCov = 100</code>.</p>
<p>Instead of setting the variance-covariance matrix to 0, we could set
a diagonal matrix with variances to vary the model parameter values
between replicates, for example
<code>genParVCov=diag(c(10,10,10))</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/generateData.html">generateData</a></span><span class="op">(</span>replicateN <span class="op">=</span> <span class="fl">100</span>, </span>
<span>             subjects <span class="op">=</span> <span class="fl">100</span>, </span>
<span>             treatSubj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>             treatDoses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>,  </span>
<span>             genParNames <span class="op">=</span> <span class="st">"E0,ED50,EMAX"</span>, </span>
<span>             genParMean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span>,<span class="fl">100</span><span class="op">)</span>, </span>
<span>             genParVCov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>,  </span>
<span>             respEqn <span class="op">=</span> <span class="st">"E0 + ((DOSE * EMAX)/(DOSE + ED50))"</span>,  </span>
<span>             respVCov <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>In this case the variance-covariance matrix is set to a diagonal
matrix with variance <em>10</em> for each parameter. This means that
<em>E0 ~ N(0,10)</em>, <em>ED50 ~ N(50,10)</em> and <em>EMAX ~
N(100,10)</em> and the values for E0, ED50 and EMAX for each replicate
will be drawn from these Normal distributions.</p>
<p>In addition, we could include correlations between the parameters E0,
ED50 and EMAX.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/generateData.html">generateData</a></span><span class="op">(</span>replicateN <span class="op">=</span> <span class="fl">100</span>, </span>
<span>             subjects <span class="op">=</span> <span class="fl">100</span>, </span>
<span>             treatSubj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>             treatDoses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>,  </span>
<span>             genParNames <span class="op">=</span> <span class="st">"E0,ED50,EMAX"</span>, </span>
<span>             genParMean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span>,<span class="fl">100</span><span class="op">)</span>, </span>
<span>             genParVCov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">1</span>,<span class="fl">10</span>,<span class="fl">1</span>,<span class="fl">8</span>,<span class="fl">10</span><span class="op">)</span>,  </span>
<span>             respEqn <span class="op">=</span> <span class="st">"E0 + ((DOSE * EMAX)/(DOSE + ED50))"</span>,  </span>
<span>             respVCov <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>Each parameter has variance equals to <em>10</em> but the correlation
between ED50 and EMAX is <em>0.8</em>, which is typical for this type of
model. Note that the variance-covariance matrix can be specified a
number of ways, as an array or a matrix, or here as values of the lower
triangle of that full variance-covariance matrix. <code>MSToolkit</code>
automatically converts these numbers to a full covariance matrix and
checks that it is positive-semi-definite using the function
<code>parseCovMatrix</code>.</p>
<p>Furthermore, we could specify the proportion of subjects in each
interim cut (note that the proportions are cumulative) by including the
argument <code>interimSubj</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/generateData.html">generateData</a></span><span class="op">(</span>replicateN <span class="op">=</span> <span class="fl">2</span>, </span>
<span>             subjects <span class="op">=</span> <span class="fl">100</span>, </span>
<span>             treatSubj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>             treatDoses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>,  </span>
<span>             genParNames <span class="op">=</span> <span class="st">"E0,ED50,EMAX"</span>, </span>
<span>             genParMean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span>,<span class="fl">100</span><span class="op">)</span>, </span>
<span>             genParVCov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">1</span>,<span class="fl">10</span>,<span class="fl">1</span>,<span class="fl">8</span>,<span class="fl">10</span><span class="op">)</span>,</span>
<span>             respEqn <span class="op">=</span> <span class="st">"E0 + ((DOSE * EMAX)/(DOSE + ED50))"</span>,  </span>
<span>             respVCov <span class="op">=</span> <span class="fl">100</span>,  </span>
<span>             interimSubj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.33</span>,<span class="fl">0.66</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In here, we have our first interim after <span class="math inline">\(\frac{1}{3}\)</span> of data, the second at <span class="math inline">\(\frac{2}{3}\)</span>. Subjects are randomly
assigned to interim proportions 1, 2, 3 with probabilty <span class="math inline">\(\frac{1}{3}\)</span> for each. This means that
there may not be exactly <span class="math inline">\(\frac{1}{3}\)</span> of subjects assigned to each
interim, as we would experience in real life.</p>
<p>We could also define the function outside of
<code>generateData</code> for specifying mean effects for each
treatment. For example, we want to precisely what the mean response will
be for an experimental drug and its control treatment. A function called
<code>resp.fn</code> is written to calculate the mean response for each
subject which takes the data with treatment identifier (<em>TRT=1 or
2</em>), DOSE information (here DOSE=0 or 1, but these are merely labels
and can be ignored in this example). The dataset also includes two
parameters - MEAN1 and MEAN2 which have values 0 and 10 respectively.
<code>resp.fn</code> must take this dataset and return a value of RESP
for each subject. So the function initialises a value for RESP
(<em>=0</em>) and then for each treatment, assigns <em>MEAN = 1</em>
where <em>TRT = 1</em> and <em>MEAN = 10</em> where <em>TRT = 2</em>.The
resulting values then have residual error added
(<code>respVCov=1</code>).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resp.fn</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">RESP</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">RESP</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">TRT</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">MEAN1</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">TRT</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">RESP</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">TRT</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">MEAN2</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">TRT</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">RESP</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span><span class="fu"><a href="../reference/generateData.html">generateData</a></span><span class="op">(</span>replicateN <span class="op">=</span> <span class="fl">2</span>, </span>
<span>             subjects <span class="op">=</span> <span class="fl">200</span>, </span>
<span>             treatSubj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>             treatDoses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,  </span>
<span>             genParNames <span class="op">=</span> <span class="st">"MEAN1, MEAN2"</span>, </span>
<span>             genParMean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>, </span>
<span>             genParVCov <span class="op">=</span> <span class="fl">0</span>,  </span>
<span>             respEqn <span class="op">=</span> <span class="va">resp.fn</span>, </span>
<span>             respVCov <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Besides, we could generate data for a crossover trial. In here, we
use the same function as above to generate the mean response for each
subject, but we swap from specifying RESP as a function of TRT into RESP
as a function of DOSE. This is because when we specify a crossover
trial, TRT becomes the treatment sequence that subjects are allocated
to, so DOSE becomes the treatment identifier for each period. This could
be a dose of drug, or simply a label (since the means here are defined
exactly for each treatment).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resp.fn</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">RESP</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">RESP</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">DOSE</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">&lt;-</span><span class="va">data</span><span class="op">$</span><span class="va">MEAN1</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">DOSE</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span>    <span class="va">RESP</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">DOSE</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">&lt;-</span><span class="va">data</span><span class="op">$</span><span class="va">MEAN2</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">DOSE</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">RESP</span></span>
<span>    <span class="op">}</span></span></code></pre></div>
<p>We use the argument <code>treatType="Crossover"</code> to show that
we are generating data for a crossover trial and we use
<code>treatSeq</code> to define the treatment sequences.
<code>treatSeq</code> should be an array, but can specify any number of
treatment periods and sequences using the labels for treatments given by
<code>treatDoses</code>, which are <em>0</em> and <em>1</em> here. The
array has sequences as columns and periods as rows. Here we have
specified a 2x2 crossover with two sequences, which is <em>DOSE = 0</em>
followed by <em>DOSE = 1</em> and vice versa. A three-period,
two-treatment design could be specified as
<code>treatSeq=array(c(0,1,1,1,0,0),dim=c(3,2))</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/generateData.html">generateData</a></span><span class="op">(</span>replicateN <span class="op">=</span> <span class="fl">2</span>, </span>
<span>             subjects <span class="op">=</span> <span class="fl">20</span>, </span>
<span>             treatSubj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>             treatDoses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>             treatType <span class="op">=</span> <span class="st">"Crossover"</span>, </span>
<span>             treatSeq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>,  </span>
<span>             genParNames <span class="op">=</span> <span class="st">"MEAN1, MEAN2"</span>, </span>
<span>             genParMean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>, </span>
<span>             genParVCov <span class="op">=</span> <span class="fl">0</span>,  </span>
<span>             genParBtwNames <span class="op">=</span> <span class="st">"MEAN1,MEAN2"</span>,</span>
<span>             genParBtwVCov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>             genParErrStruc <span class="op">=</span> <span class="st">"Additive"</span>,  </span>
<span>             respEqn <span class="op">=</span> <span class="va">resp.fn</span>, </span>
<span>             respVCov <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We must also take a little extra care in thinking about the data
generation processes in crossover trials. In a crossover we can assume
that the treatment effect is constant across treatment periods, but we
usually assume that an individual’s responses between periods is
correlated - that is subjects with high observations in period 1 will
have high observations in period 2. We do this by specifying
<strong>between subject variability</strong> in the parameter means
through <code>genParBtwNames = "MEAN1,MEAN2"</code>,
<code>genParBtwVCov = c(1,0.8,1)</code> and
<code>genParErrStruc = "Additive"</code>. These options add between
subject variability to <em>MEAN1</em> and <em>MEAN2</em> with a
correlation of <em>0.8</em> between them. Thus subjects with high MEAN1
will also have high MEAN2. Finally the residual error is added through
<code>respVCov</code> as usual. Then, in the analysis, we will look for
treatment effects within subjects and we can also look at period effects
and sequence effects (none simulated here).</p>
<p>At last, <code>MSToolkit</code> creates a sub-directory called
<em>ReplicateData</em> under the current R working directory for the
output from the <code>generateData</code> function. The individual
replicate datasets are stored in CSV format in this directory and are
named <em>replicate000x.csv</em>. There are up to 9999 replicate
datasets can be created.</p>
</div>
<div class="section level2">
<h2 id="illustration-of-analyzedata-function-by-an-example">Illustration of <code>analyzeData</code> function by an example<a class="anchor" aria-label="anchor" href="#illustration-of-analyzedata-function-by-an-example"></a>
</h2>
<p>In here, the <code>analyzeData</code> function would be illustrated
by a completed example, included the data generation process, data
analysis process and the decision criteria.</p>
<div class="section level3">
<h3 id="data-generation">Data generation<a class="anchor" aria-label="anchor" href="#data-generation"></a>
</h3>
<div class="section level4">
<h4 id="design">Design<a class="anchor" aria-label="anchor" href="#design"></a>
</h4>
<p>The design for this study is as follows:</p>
<ul>
<li>
<em>100</em> subjects</li>
<li>Parallel group</li>
<li>
<em>5</em> doses: <em>Placebo, 5, 10, 50, 100mg</em> (units are
arbitrary in this example)</li>
<li>Patients are allocated randomly to each dose (i.e. we do not
guarantee equal allocation to each treatment arm).</li>
<li>Interim analyses after <em>30%</em> and <em>70%</em> of subjects
have provided response</li>
</ul>
</div>
<div class="section level4">
<h4 id="response-generation-function">Response generation function<a class="anchor" aria-label="anchor" href="#response-generation-function"></a>
</h4>
<ul>
<li>Emax model: <span class="math inline">\(RESP = E0 + \frac{(EMAX *
DOSE)}{(ED50 + DOSE)}\)</span>
<ul>
<li><em>E0 ~ N(2, 0.5)</em></li>
<li><em>ED50 ~ N(50, 30)</em></li>
<li><em>EMAX ~ N(10,10)</em></li>
</ul>
</li>
<li>
<span class="math inline">\(Residual error \sim N(0,2)\)</span>
<ul>
<li>Additive (i.e. <em>Y = RESP + residual error</em>)</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="simulation-specification">Simulation specification<a class="anchor" aria-label="anchor" href="#simulation-specification"></a>
</h4>
<ul>
<li>
<em>5</em> trial replicates</li>
<li>Simulate with model parameter uncertainty (i.e. each replicate has
unique values for model parameters, drawn from an underlying
multivariate distribution).</li>
<li>In this case, model parameters are independent (i.e. off-diagonal
elements of the multivariate variance-covariance matrix are zero).</li>
</ul>
<p>We apply the information as above to
<code>generateData</code>function to simulate the data:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/generateData.html">generateData</a></span><span class="op">(</span></span>
<span>  replicateN <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  subjects <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  treatDoses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  genParNames <span class="op">=</span> <span class="st">"E0, ED50, EMAX"</span>,</span>
<span>  genParMean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">50</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  genParVCov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">30</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  respEqn <span class="op">=</span> <span class="st">"E0 + ((DOSE * EMAX)/(DOSE + ED50))"</span>,</span>
<span>  respVCov <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  interimSubj <span class="op">=</span> <span class="st">"0.3, 0.7"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="evaluation-of-operating-characteristics">Evaluation of operating characteristics<a class="anchor" aria-label="anchor" href="#evaluation-of-operating-characteristics"></a>
</h3>
<p>Before executing the data analysis, we need to introduce a concept
-operating characteristics. Operating characteristics here refer to the
performance of the given design + analysis + decision criteria. We are
usually interested in the probability of making correct decisions
(correct GO and correct NO GO) and the probabilities of making false
positive or false negative decisions separately. Many factors can
influence these probabilities:</p>
<ul>
<li>Dose-selection and numbers of subjects influence the precision of
our estimated parameters.</li>
<li>The choice of model and model selection process.</li>
<li>How we handle estimation when the observed data do not match our a
priori model selection.</li>
<li>Or our decision criteria and whether this is based purely on the
estimated mean or whether it involves interval estimates.</li>
</ul>
<div class="section level4">
<h4 id="micro-evaluation-of-a-priori-effect-vs-simulated-observed">Micro-evaluation of a priori effect vs simulated / “observed”<a class="anchor" aria-label="anchor" href="#micro-evaluation-of-a-priori-effect-vs-simulated-observed"></a>
</h4>
<p>With MSToolkit we introduce the idea of micro-evaluation (a treatment
specific comparison of a priori known effects or “truth” vs simulated
trial, “observed” or estimated effects). Micro-evaluation will help
characterise bias and precision of estimated parameters or treatment
effects. We use this to help refine the analytical methods - we should
aim to reduce bias and increase precision of our estimates for a given
data generation + analysis method. Note that it is good practice to
investigate micro-evaluation properties for “null” data generation cases
i.e. where there is a prior no effect. We usually also look at
sensitivity to a priori assumptions. We can do this by varying the data
generation model compared to the assumptions made by the analysis
method. This can include generating data from non-monotonic increasing
functions when analysis assumes monotonically increasing dose-response
functions.</p>
</div>
<div class="section level4">
<h4 id="macro-evaluation-to-assess-decision-criteria">Macro-evaluation to assess decision criteria<a class="anchor" aria-label="anchor" href="#macro-evaluation-to-assess-decision-criteria"></a>
</h4>
<p>MSToolkit also uses what we call “macro-evaluation” to assess the
operating characteristics of our decision criteria. Macro-evaluation
aims to make an overall decision about the “success” or “failure” of a
trial. Usually the macro-evaluation decision criteria compares the
decision made for the simulated trial data with the decision that would
have been made given perfect information or the a prior known
“truth”.</p>
</div>
</div>
<div class="section level3">
<h3 id="performing-data-analysis-by-using-r-function">Performing data analysis by using R function<a class="anchor" aria-label="anchor" href="#performing-data-analysis-by-using-r-function"></a>
</h3>
<div class="section level4">
<h4 id="defining-the-analysiscode-function">Defining the <code>analysisCode</code> function<a class="anchor" aria-label="anchor" href="#defining-the-analysiscode-function"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emaxCode</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">uniDoses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">DOSE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">obsMean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">RESP</span>, </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">DOSE</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></span>
<span>  <span class="va">obsSD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">RESP</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">DOSE</span><span class="op">)</span>, <span class="va">sd</span><span class="op">)</span></span>
<span>  <span class="va">eFit</span> <span class="op">&lt;-</span> <span class="fu">emax.fit</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">RESP</span>, <span class="va">data</span><span class="op">$</span><span class="va">DOSE</span><span class="op">)</span></span>
<span>  <span class="va">outDf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>DOSE <span class="op">=</span> <span class="va">uniDoses</span>,</span>
<span>                      MEAN <span class="op">=</span> <span class="va">eFit</span><span class="op">$</span><span class="va">fitpred</span>,</span>
<span>                      SE <span class="op">=</span> <span class="va">eFit</span><span class="op">$</span><span class="va">sdpred</span>,</span>
<span>                      SDDIF <span class="op">=</span> <span class="va">eFit</span><span class="op">$</span><span class="va">sddif</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">outDf</span><span class="op">$</span><span class="va">LOWER</span> <span class="op">&lt;-</span> <span class="va">outDf</span><span class="op">$</span><span class="va">MEAN</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">outDf</span><span class="op">$</span><span class="va">SE</span></span>
<span>  <span class="va">outDf</span><span class="op">$</span><span class="va">UPPER</span> <span class="op">&lt;-</span> <span class="va">outDf</span><span class="op">$</span><span class="va">MEAN</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">outDf</span><span class="op">$</span><span class="va">SE</span></span>
<span>  <span class="va">outDf</span><span class="op">$</span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">DOSE</span><span class="op">)</span></span>
<span>  <span class="va">outDf</span><span class="op">$</span><span class="va">OBSMEAN</span> <span class="op">&lt;-</span> <span class="va">obsMean</span></span>
<span>  <span class="va">outDf</span><span class="op">$</span><span class="va">OBSSD</span> <span class="op">&lt;-</span> <span class="va">obsSD</span></span>
<span>  <span class="va">outDf</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The example code above is using the function emax.fit to perform the
basic analysis. This function allows access to many summaries of the
model that is fit to the data. The replicate datasets are passed to the
function through the argument data.</p>
<p>Analysis output (the micro-evaluation datasets named as
<em>micro000x.csv</em>) are stored in the
<strong>MicroEvaluation</strong> sub-directory within the working
directory. One dataset is stored for each replicate. The
<code>analyzeData</code> function collates the individual
<em>micro000x.csv</em> files into a single
<strong>MicroSummary.csv</strong> data file after the last replicate is
analyzed. This <strong>MicroSummary.csv</strong> file is stored at the
top level of the working directory.</p>
</div>
<div class="section level4">
<h4 id="interim-analysis">Interim analysis<a class="anchor" aria-label="anchor" href="#interim-analysis"></a>
</h4>
<p><strong>NOTE</strong> that you need to specify interim analysis
proportions in the generated data <strong>BEFORE</strong> you analyze
the replicate dataset. If subjects are not assigned to interim cuts in
the generated data, the interim analysis steps will not be carried out
(the <code>analyzeData</code> function assumes that all subjects are in
the full dataset).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interimCode</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="co"># DROP any doses where the lower bound of the difference from placebo is negative</span></span>
<span>  <span class="va">dropdose</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">DOSE</span> <span class="op">[</span><span class="va">LOWER</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">DOSE</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">outList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dropdose</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> </span>
<span>    <span class="va">outList</span><span class="op">$</span><span class="va">DROP</span> <span class="op">&lt;-</span> <span class="va">dropdose</span></span>
<span>  <span class="va">outList</span><span class="op">$</span><span class="va">STOP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dropdose</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="va">outList</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The interimcode function above will be run <strong>AFTER</strong> the
<code>analysisCode</code> at each specified interim analysis and the
function specifies rules for dropping doses or terminating the study.
<strong>REQUIRED</strong> outputs are <strong>DROP</strong> and
<strong>STOP</strong>.</p>
<p>The code above checks whether the lower confidence limit for the
difference from placebo for each dose is below zero i.e. no difference
from placebo. The <em>DROP</em> variable is a vector of those doses
which are to be dropped from the study. <em>STOP</em> is a flag which
indicates whether the study should stop. In this case, if all doses are
included in <em>DROP</em> (not including placebo) then the study is
stopped.</p>
<p>The micro-evaluation dataset <strong>micro000x.csv</strong> found in
the <strong>MicroEvaluation</strong> sub-directory (see below) compiles
together results from the analysis of each interim. It contains a column
<em>INTERIM</em> which indicates which interim analysis the results
pertain to. <em>INTERIM==0</em> denotes the analysis of the FULL dataset
(i.e. if no doses are dropped and assuming the study goes on to
completion). This allows us to compare an adaptive design against a
non-adaptive design in one step. If, after interim evaluation we drop a
dose, then <em>DROPPED=1</em> for this dose and subjects on this dose
are not included in evaluation at the subsequent interims. Information
on that dose already gained will be carried forward into subsequent
interim analysis and updated with the new model evaluation, but the dose
will remain closed for allocation. The <em>micro000x.csv</em> dataset
also includes the STOPPED variable which indicates that at a specific
interim analysis the study was stopped. Note that we perform the
analysis of the FULL (100%) dataset BEFORE conducting the interim
analyses so that if the decision is made to stop the study we can
compare results against the comparable data without interim
analysis.</p>
</div>
<div class="section level4">
<h4 id="marco-evaluation-code">Marco-evaluation code<a class="anchor" aria-label="anchor" href="#marco-evaluation-code"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">macroCode</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Is effect at highest dose significant?</span></span>
<span>  <span class="va">success</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">data</span><span class="op">$</span><span class="va">LOWER</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">INTERIM</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">INTERIM</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">data</span><span class="op">$</span><span class="va">DOSE</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">DOSE</span><span class="op">)</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">7</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>SUCCESS <span class="op">=</span> <span class="va">success</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The above macro-evaluation code looks at the lower confidence limits
of the difference over placebo and if all of these values are less than
zero declares the trial a failure. If at least ONE of these confidence
limits are above zero then the trial is deemed a success. The
<strong>MacroEvaluation</strong> directory contains the results of
macro-evaluation (macroCode output) for each replicate in the
<em>macro000x.csv</em> dataset. The <code>analyzeData</code> function
compiles these into a <strong>MacroSummary.csv</strong> file which is
stored at the top level of the working directory.</p>
<p>The macroCode function can return any macro-evaluation summary that
is useful for assessing the trial-level operating characteristics, like
success or failure, bias and precision of parameter estimates, etc.</p>
</div>
<div class="section level4">
<h4 id="running-analysis-using-analyzedata">Running analysis using <code>analyzeData</code><a class="anchor" aria-label="anchor" href="#running-analysis-using-analyzedata"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/analyzeData.html">analyzeData</a></span><span class="op">(</span>analysisCode <span class="op">=</span> <span class="va">emaxCode</span>,</span>
<span>            macroCode <span class="op">=</span> <span class="va">macroCode</span>,</span>
<span>            interimCode <span class="op">=</span> <span class="va">interimCode</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># analysisCode and macroCode are REQUIRED inputs.</span></span></code></pre></div>
<p><code>analyzeData</code> wraps the analysis and micro-evaluation,
macro-evaluation and interim analysis functions together and controls
the input or output of replicate data
(<strong>replicate000x.csv</strong> from the
<strong>ReplicateData</strong> subdirectory), passing this to the
analysis function (as argument <strong>data</strong>) and returning the
micro-evaluation output <strong>micro000x.csv</strong> for each
replicate to the <strong>MicroEvaluation</strong> subdirectory. It also
applies the macro-evaluation function to the micro000x dataset,
generating a <strong>macro000x.csv</strong> dataset which is stored in
the <strong>MacroEvaluation</strong> subdirectory. Should interim
analysis be requested, the <code>analyzeData</code> function will apply
the <code>analysisCode</code> function first to the full dataset, then
to each interim cut of the data. For each interim cut (not including the
FULL dataset analysis) the <code>interimCode</code> function will be
applied to decide whether to DROP doses or STOP the study.</p>
</div>
</div>
<div class="section level3">
<h3 id="performing-data-analysis-by-using-sas-code">Performing data analysis by using SAS code<a class="anchor" aria-label="anchor" href="#performing-data-analysis-by-using-sas-code"></a>
</h3>
<p>We could also apply the SAS code to <code>analyzeData</code>
function. If using SAS code to perform analysis, the code
<strong>MUST</strong> be placed at the <strong>TOP</strong> level of the
working directory. The code should be written to accept a working input
dataset called <em>INFILE</em> and should return a final dataset of
results called <em>OUTFILE</em>. Both of these datasets should be
contained in the <em>WORK</em> directory (i.e. <strong>NOT</strong>
permanent SAS datasets). Code should be written to be robust to errors.
It is the user’s responsibility to track errors within the SAS code.</p>
<p>To call external SAS code for analysis the following syntax should be
used:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/analyzeData.html">analyzeData</a></span><span class="op">(</span>analysisCode <span class="op">=</span> <span class="st">"emax.sas"</span>, </span>
<span>            software <span class="op">=</span> <span class="st">"SAS"</span>, </span>
<span>            macroCode <span class="op">=</span> <span class="va">macrocode</span><span class="op">)</span></span></code></pre></div>
<p><code>macroCode</code> functions can be written in R. The SAS output
will be passed back into R and macro-evaluation carried out on each
replicate as though the analysis had been carried out in R.</p>
<p>For the above example we ran the following SAS analysis code. This
code analyses the generated data using a basic <em>PROC NLIN</em> call.
In this example we are only interested in assessing the model fit
parameters against the “true” values used in data generation. We use the
<em>SAS ODS</em> system to create a dataset of the model parameters.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ods output parameterestimates<span class="ot">=</span>parms corrb<span class="ot">=</span>corr;</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>proc nlin;</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a> model resp<span class="ot">=</span>e0 <span class="sc">+</span> (emax <span class="sc">*</span> dose) <span class="sc">/</span> (ed50 <span class="sc">+</span> dose);  <span class="co"># Specify the form of the Emax equation;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a> parameters e0 <span class="ot">=</span> <span class="dv">0</span> ed50 <span class="ot">=</span> <span class="dv">25</span> emax <span class="ot">=</span> <span class="dv">120</span>;  <span class="co"># Specify starting values for the parameters;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a> bounds ed50 <span class="sc">&gt;</span> <span class="dv">0</span>;   <span class="co"># Set up boundary conditions.  Here ED50 must be positive;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>ods output close;</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>proc transpose data<span class="ot">=</span>parms out<span class="ot">=</span>tparms prefix<span class="ot">=</span>mean;</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a> var estimate;</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a> id parameter; </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>proc transpose data<span class="ot">=</span>parms out<span class="ot">=</span>stderr prefix<span class="ot">=</span>se;</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a> var estimate;</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a> id parameter; </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>proc sql noprint;</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a> create table doses as</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>   select <span class="fu">unique</span>(dose) as dose</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>   from infile;</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a> create table parms2 as</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>   select <span class="sc">*</span> from tparms t, stderr s;</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a> create table doseparms as</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>   select <span class="sc">*</span> from doses d, tparms t, stderr s;</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a> create table obsvars as</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>   select <span class="fu">mean</span>(resp) as dsm, <span class="fu">var</span>(resp) as dsv,<span class="fu">count</span>(resp) as n</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>   from infile</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>   group by dose;</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>quit;</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>data <span class="fu">outfile</span> (<span class="at">drop=</span>_name_);</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a> retain mean se lower upper <span class="dv">0</span>;</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a> set doseparms;</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a> mean<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a> se<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a> lower<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a> upper<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a> n<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a> run;</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="troubleshooting-the-analysis-code">Troubleshooting the analysis code<a class="anchor" aria-label="anchor" href="#troubleshooting-the-analysis-code"></a>
</h2>
<p>To troubleshoot analysis or interim code or macro-evaluation code you
can read in the individual dataset with this code:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readData.html">readData</a></span><span class="op">(</span> dataNumber <span class="op">=</span> <span class="fl">1</span>, dataType <span class="op">=</span> <span class="st">"Replicate"</span><span class="op">)</span></span></code></pre></div>
<p>then run the <code>analysisCode</code> function (i.e. the
<code>EmaxCode</code> function generated above) over this</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">EmaxCode</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p>Output from the <code>EmaxCode</code> function should be the
<em>micro-evaluation</em> dataset. However if this doesn’t return the
right dataset it’s easier to troubleshoot than running all 100 of the
replicates.</p>
<p>You can check the <code>macroCode</code> function by reading in the
<em>micro-evaluation</em> dataset:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"./microevaluation/micro0001.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The micro-evaluation dataset is stored in the MicroEvaluation sub-directory </span></span>
<span><span class="co"># within the working directory</span></span></code></pre></div>
<p>and then run the <code>macroCode</code> function (i.e. the
<code>macroCode</code> function generated above) over this:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">macroCode</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p>Once you’re happy with this, you can go on to look at how the
<code>interimCode</code> works by running:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/analyzeRep.html">analyzeRep</a></span><span class="op">(</span>analysisCode <span class="op">=</span> <span class="va">emaxCode</span>,</span>
<span>           interimCode <span class="op">=</span> <span class="va">interimcode</span>,</span>
<span>           replicate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>This will do the full analysis or micro-evaluation step at interims
as well as on the full dataset. <strong>NOTE</strong> that you need to
specify interim analysis proportions in the generated data BEFORE you
analyze the replicate dataset. If subjects are not assigned to interim
cuts in the generated data, the interim analysis steps will not be
carried out (the <code>analyzeData</code> function assumes that all
subjects are in the FULL dataset).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mike K Smith, Rich Pugh, Roman Francois, Francisco Gochez.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
