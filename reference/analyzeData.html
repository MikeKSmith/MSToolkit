<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Analyzes a set of simulated trial data, possibly including interim analyses"><title>Analyze simulated data replicates — analyzeData • MSToolkit</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyze simulated data replicates — analyzeData"><meta property="og:description" content="Analyzes a set of simulated trial data, possibly including interim analyses"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MSToolkit</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/MSToolkit_intro_vig.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/generate_data.html">generateData</a>
    <a class="dropdown-item" href="../articles/analyze_data.html">analyzeData</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Background Reading</h6>
    <a class="dropdown-item" href="../articles/simulation_overview.html">Simulation Overview</a>
    <a class="dropdown-item" href="../articles/references.html">References</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MikeKSmith/MSToolkit/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Analyze simulated data replicates</h1>
      <small class="dont-index">Source: <a href="https://github.com/MikeKSmith/MSToolkit/blob/HEAD/R/analyzeData.r" class="external-link"><code>R/analyzeData.r</code></a></small>
      <div class="d-none name"><code>analyzeData.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Analyzes a set of simulated trial data, possibly including interim analyses</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">analyzeData</span><span class="op">(</span></span>
<span>  replicates <span class="op">=</span> <span class="st">"*"</span>,</span>
<span>  <span class="va">analysisCode</span>,</span>
<span>  <span class="va">macroCode</span>,</span>
<span>  interimCode <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  software <span class="op">=</span> <span class="st">"R"</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  waitAndCombine <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cleanUp <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  removeMissing <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  removeParOmit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  removeRespOmit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fu">.deriveFromMasterSeed</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  parOmitFlag <span class="op">=</span> <span class="fu"><a href="getEctdColName.html">getEctdColName</a></span><span class="op">(</span><span class="st">"ParOmit"</span><span class="op">)</span>,</span>
<span>  respOmitFlag <span class="op">=</span> <span class="fu"><a href="getEctdColName.html">getEctdColName</a></span><span class="op">(</span><span class="st">"RespOmit"</span><span class="op">)</span>,</span>
<span>  missingFlag <span class="op">=</span> <span class="fu"><a href="getEctdColName.html">getEctdColName</a></span><span class="op">(</span><span class="st">"Missing"</span><span class="op">)</span>,</span>
<span>  interimCol <span class="op">=</span> <span class="fu"><a href="getEctdColName.html">getEctdColName</a></span><span class="op">(</span><span class="st">"Interim"</span><span class="op">)</span>,</span>
<span>  doseCol <span class="op">=</span> <span class="fu"><a href="getEctdColName.html">getEctdColName</a></span><span class="op">(</span><span class="st">"Dose"</span><span class="op">)</span>,</span>
<span>  sleepTime <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  deleteCurrData <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  initialDoses <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stayDropped <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fullAnalysis <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  workingPath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="setEctdDataMethod.html">getEctdDataMethod</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>replicates</dt>
<dd><p>(Optional) Vector of replicates on which to perform
analysis: all replicates are analyzed by default</p></dd>


<dt>analysisCode</dt>
<dd><p>(Required) File containing analysis code (for R or SAS)
or an R function for analysis (R only)</p></dd>


<dt>macroCode</dt>
<dd><p>(Required) An R function to be used for macro evaluation of
the result datasets.  See the help file for the
<code><a href="macroEvaluation.html">macroEvaluation</a></code> function for more information</p></dd>


<dt>interimCode</dt>
<dd><p>(Optional) An R function to be applied to interim
datasets in order to creation interim decisions.  See the help file for the
<code><a href="interimAnalysis.html">interimAnalysis</a></code> function for more information.  By default, no
functions is provided, resulting in no interim analyses being performed</p></dd>


<dt>software</dt>
<dd><p>(Optional) The software to be used for analysis: either "R"
or "SAS".  "R" is the default software used</p></dd>


<dt>grid</dt>
<dd><p>(Optional) If available, should the analysis be split across
available CPUs.  Uses the "parallel" package to split jobs across available
cores.  Uses minimum of either: Cores-1 or getOption("max.clusters"),
usually =2. FALSE by default.</p></dd>


<dt>waitAndCombine</dt>
<dd><p>(Optional) Should the process wait for all analyses to
finish, then combine into micro and macro summary files?  TRUE by default</p></dd>


<dt>cleanUp</dt>
<dd><p>(Optional) Should micro/macro directories be removed on
completion?  TRUE by default</p></dd>


<dt>removeMissing</dt>
<dd><p>(Optional) Should rows marked as 'Missing' during the
data generation step be removed from the data before analysis is performed?
TRUE by default</p></dd>


<dt>removeParOmit</dt>
<dd><p>(Optional) Should any rows marked as 'Omitted' during
the parameter data generation step (ie. parameters out of range) be removed
from the data before analysis is performed?  TRUE by default</p></dd>


<dt>removeRespOmit</dt>
<dd><p>(Optional) Should any rows marked as 'Omitted' during
the response generation step (ie. responses out of range) be removed from
the data before analysis is performed?  TRUE by default</p></dd>


<dt>seed</dt>
<dd><p>(Optional) Random number seed to use for the analysis.  Based on
the current random seed by default</p></dd>


<dt>parOmitFlag</dt>
<dd><p>(Optional) Parameter omit flag name.  "PAROMIT" by
default</p></dd>


<dt>respOmitFlag</dt>
<dd><p>(Optional) Response omit flag name.  "RESPOMIT" by
default</p></dd>


<dt>missingFlag</dt>
<dd><p>(Optional) Missing flag name.  "MISSING" by default</p></dd>


<dt>interimCol</dt>
<dd><p>(Optional) Interim variable name.  "INTERIM" by default</p></dd>


<dt>doseCol</dt>
<dd><p>(Optional) Dose variable name.  "DOSE" by default</p></dd>


<dt>sleepTime</dt>
<dd><p>(Optional) Number of seconds to sleep between iterative
checks for grid job completion.  15 seconds are used by default</p></dd>


<dt>deleteCurrData</dt>
<dd><p>(Optional) Should any existing micro evaluation and
macro evaluation data be removed before new analysis is performed?  TRUE by
default</p></dd>


<dt>initialDoses</dt>
<dd><p>(Optional) For interim analyses, which doses should be
present in interim 1?  All are included by default</p></dd>


<dt>stayDropped</dt>
<dd><p>(Optional) For interim analyses, if a dose is dropped,
should it stay dropped in following interims (as opposed to allowing the
interim step to reopen the dose)</p></dd>


<dt>fullAnalysis</dt>
<dd><p>(Optional) Should a "full" analysis be performed on all
doses?  Default TRUE</p></dd>


<dt>workingPath</dt>
<dd><p>(Optional) Root directory in which replicate data is
stored, and in which we should perform the analysis.  Current working
directory is used by default</p></dd>


<dt>method</dt>
<dd><p>Data storage method (ie. where the replicate data is stored).
Given by <a href="setEctdDataMethod.html">getEctdDataMethod</a> by default</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>This function will produce no direct output.  As a consequence,
however, many analysis, summary and log files will be produced.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The first task of the function will be to check the options specifed: * If
the "grid" network is unavailable or if the length of the "replicates" input
is 1, the "grid" flag will be set to FALSE * If the "grid" flag is TRUE, the
call to <code>analyzeData</code> will be split across multiple processors
using the "parallel" library * If the length of the "replicates" vector is
1, the "waitAndCombine" flag will be set to FALSE * If the "waitAndCombine"
flag is set to FALSE, the "cleanUp" flag will also be set to FALSE</p>
<p>The <code>analyzeData</code> function will iterate around each replicate
specified in the "replicates" vector.  For each replicate, the function will
first call the <code><a href="analyzeRep.html">analyzeRep</a></code> with the required inputs. The output
from the call to <code><a href="analyzeRep.html">analyzeRep</a></code> will be a data frame containing
micro evaluation data.  This data frame will be checked to ensure it is of
the correct format. If the return from <code><a href="analyzeRep.html">analyzeRep</a></code> is a valid
"Micro Evaluation" dataset, it will be saved to the "MicroEvaluation"
folder, and also passed to the <code><a href="macroEvaluation.html">macroEvaluation</a></code> function for
further analysis. If the return from <code><a href="macroEvaluation.html">macroEvaluation</a></code> is a
valid "Macro Evaluation" dataset, it will be saved to the "MicroEvaluation"
folder.</p>
<p>If the "waitAndCombine" flag is set to TRUE, the function will wait until
all grid jobs are finished (if grid has been used), then compile the "Micro"
and "Macro" evaluation results into single summary files (using the
<code><a href="compileSummary.html">compileSummary</a></code> function).</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>There are some restrictions on the code inputs to the
<code>analyzeData</code> function.  These restrictions are discussed here:</p>
<p>Analysis Code: The "analysisCode" input must be either an R function or a
reference to an external file.  If it is a reference to external file, it
must contain either SAS code (if software is "SAS") or R code (if software
is "R").  If the code is an R function, or an external R script, it must
accept a data frame as it's only argument and return an acceptable "Micro
Evaluation" data frame as set out in <code><a href="checkMicroFormat.html">checkMicroFormat</a></code>.  If the
code is an external SAS script, it must accept use a SAS dataset called
"work.infile" and create a SAS dataset called "work.outfile" that conforms
to the "Micro Evalutation" format as set out in
<code><a href="checkMicroFormat.html">checkMicroFormat</a></code>.  More information on "Micro Evaluation"
structures can be found in the help file for function
<code><a href="checkMicroFormat.html">checkMicroFormat</a></code>.</p>
<p>Interim Code: The "interimCode" input must be an R function that accepts a
single "Micro Evaluation" data input, and returns an R "list" structure that
is either empty or contains one or more of the following elements: An
element called "STOP" which is a logical vector of length 1.  This tells the
<code>analyzeData</code> function whether the analysis should be halted at
this interim An element called "DROP" which is a vector of numeric values
relating to doses in the data to drop before the next interim is analyzed.
More information on "Micro Evaluation" structures can be found in the help
file for function <code><a href="interimAnalysis.html">interimAnalysis</a></code>.</p>
<p>Macro Code: The "macroCode" input must be an R function that accepts an
enhanced "Micro Evaluation" data input, and returns a valid "Macro
Evaluation" data structure (as specified in the help file for the
<code><a href="checkMacroFormat.html">checkMacroFormat</a></code> function.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="analyzeRep.html">analyzeRep</a></code>, <code><a href="macroEvaluation.html">macroEvaluation</a></code>,
<code><a href="compileSummary.html">compileSummary</a></code> and <code><a href="generateData.html">generateData</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Mike K Smith <a href="mailto:mstoolkit@googlemail.com">mstoolkit@googlemail.com</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Standard analysis code</span></span></span>
<span class="r-in"><span><span class="va">emaxCode</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">DoseResponse</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>    <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">uniDoses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DOSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">eFit</span> <span class="op">&lt;-</span> <span class="fu">emaxalt</span><span class="op">(</span> <span class="va">RESP</span>, <span class="va">DOSE</span> <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">outDf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> DOSE <span class="op">=</span> <span class="va">uniDoses</span>,</span></span>
<span class="r-in"><span>      MEAN <span class="op">=</span> <span class="va">eFit</span><span class="op">$</span><span class="va">dm</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">uniDoses</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>      SE <span class="op">=</span> <span class="va">eFit</span><span class="op">$</span><span class="va">dsd</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">uniDoses</span><span class="op">)</span><span class="op">]</span> <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">outDf</span><span class="op">$</span><span class="va">LOWER</span> <span class="op">&lt;-</span> <span class="va">outDf</span><span class="op">$</span><span class="va">MEAN</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">outDf</span><span class="op">$</span><span class="va">SE</span></span></span>
<span class="r-in"><span>    <span class="va">outDf</span><span class="op">$</span><span class="va">UPPER</span> <span class="op">&lt;-</span> <span class="va">outDf</span><span class="op">$</span><span class="va">MEAN</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">outDf</span><span class="op">$</span><span class="va">SE</span></span></span>
<span class="r-in"><span>    <span class="va">outDf</span><span class="op">$</span><span class="va">N</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">DOSE</span><span class="op">)</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">uniDoses</span><span class="op">)</span> <span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="va">outDf</span></span></span>
<span class="r-in"><span>  <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Macro evaluation code</span></span></span>
<span class="r-in"><span><span class="va">macrocode</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># making up a t-test</span></span></span>
<span class="r-in"><span>  <span class="va">mu0</span>   <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">MEAN</span><span class="op">[</span> <span class="va">data</span><span class="op">$</span><span class="va">DOSE</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">data</span><span class="op">$</span><span class="va">INTERIM</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">mu100</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">MEAN</span><span class="op">[</span> <span class="va">data</span><span class="op">$</span><span class="va">DOSE</span> <span class="op">==</span> <span class="fl">100</span> <span class="op">&amp;</span> <span class="va">data</span><span class="op">$</span><span class="va">INTERIM</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">n0</span>    <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">N</span><span class="op">[</span> <span class="va">data</span><span class="op">$</span><span class="va">DOSE</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">data</span><span class="op">$</span><span class="va">INTERIM</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">n100</span>  <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">N</span><span class="op">[</span> <span class="va">data</span><span class="op">$</span><span class="va">DOSE</span> <span class="op">==</span> <span class="fl">100</span> <span class="op">&amp;</span> <span class="va">data</span><span class="op">$</span><span class="va">INTERIM</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">sd0</span>   <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">SE</span><span class="op">[</span> <span class="va">data</span><span class="op">$</span><span class="va">DOSE</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">data</span><span class="op">$</span><span class="va">INTERIM</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">sd100</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">SE</span><span class="op">[</span> <span class="va">data</span><span class="op">$</span><span class="va">DOSE</span> <span class="op">==</span> <span class="fl">100</span> <span class="op">&amp;</span> <span class="va">data</span><span class="op">$</span><span class="va">INTERIM</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">sddiff</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span> <span class="va">n0</span> <span class="op">==</span> <span class="va">n100</span> <span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span> <span class="op">(</span><span class="va">sd0</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">sd100</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>  <span class="op">/</span> <span class="op">(</span><span class="va">n0</span> <span class="op">+</span> <span class="va">n100</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n0</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="va">n100</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span> <span class="op">(</span><span class="va">n0</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">sd0</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">n100</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">sd100</span><span class="op">^</span><span class="fl">2</span>  <span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">n0</span><span class="op">+</span><span class="va">n100</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">tstat</span>  <span class="op">&lt;-</span> <span class="op">(</span> <span class="va">mu100</span> <span class="op">-</span> <span class="va">mu0</span> <span class="op">)</span> <span class="op">/</span> <span class="va">sddiff</span></span></span>
<span class="r-in"><span>  <span class="va">success</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">tstat</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span> <span class="fl">.975</span>, <span class="va">n0</span><span class="op">+</span><span class="va">n100</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> SUCCESS <span class="op">=</span> <span class="va">success</span>, TSTAT <span class="op">=</span> <span class="va">tstat</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Interim analysis code</span></span></span>
<span class="r-in"><span><span class="va">interimCode</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">data</span> <span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">dropdose</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span> <span class="va">data</span>, <span class="va">DOSE</span> <span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">UPPER</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">LOWER</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">DOSE</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">]</span> <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">outList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dropdose</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> <span class="va">outList</span><span class="op">$</span><span class="va">DROP</span> <span class="op">&lt;-</span> <span class="va">dropdose</span></span></span>
<span class="r-in"><span>  <span class="va">outList</span><span class="op">$</span><span class="va">STOP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dropdose</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span></span></span>
<span class="r-in"><span>  <span class="va">outList</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run analysis</span></span></span>
<span class="r-in"><span><span class="fu">analyzeData</span><span class="op">(</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, analysisCode <span class="op">=</span> <span class="va">emaxCode</span>, macroCode <span class="op">=</span> <span class="va">macrocode</span>,</span></span>
<span class="r-in"><span>  interimCode <span class="op">=</span> <span class="va">interimCode</span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Mike K Smith, Rich Pugh, Roman Francois, Francisco Gochez.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

