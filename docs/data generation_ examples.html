<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1038.32">
  <style type="text/css">
    body {background-color: #FFFFFF}
    p.p1 {margin: 0.0px 0.0px 14.0px 0.0px; font: 24.0px Arial; color: #0000ee}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Lucida Grande'}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 24.0px Arial; min-height: 28.0px}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Courier}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Courier; color: #ad331d}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Courier; color: #2c5f2f}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Courier; min-height: 17.0px}
    p.p9 {margin: 0.0px 0.0px 12.0px 0.0px; font: 14.0px Arial}
    p.p10 {margin: 0.0px 0.0px 12.0px 0.0px; font: 14.0px Arial; min-height: 16.0px}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Courier; color: #08339e}
    p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Arial; min-height: 16.0px}
    p.p13 {margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Arial; min-height: 21.0px}
    p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Arial}
    p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px 'Lucida Grande'; min-height: 17.0px}
    p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Courier; color: #b1110c}
    p.p17 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Courier; color: #022296; min-height: 17.0px}
    li.li4 {margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Arial}
    span.s1 {color: #08339e}
    span.s2 {color: #2c5f2f}
    span.s3 {color: #ad331d}
    span.s4 {color: #000000}
    span.s5 {font: 14.0px Courier}
    span.s6 {text-decoration: underline ; color: #0000ee}
    span.s7 {color: #c59942}
    span.s8 {font: 14.0px Courier; color: #08339e}
    span.s9 {font: 14.0px Arial}
    span.s10 {color: #022296}
    span.s11 {color: #02511c}
    span.s12 {color: #b1110c}
    span.Apple-tab-span {white-space:pre}
    ol.ol1 {list-style-type: decimal}
  </style>
</head>
<body>
<p class="p1"><a href="file:///Users/mike/Documents/SVN/www/data%20generation_%20examples.html"><b>Data Generation: Examples</b></a></p>
<p class="p2">1. Basic linear model</p>
<p class="p2">2. Basic Emax model</p>
<p class="p2">3. Emax model with variability between replicates in parameters</p>
<p class="p2">4. Emax model with correlation between replicates in parameters</p>
<p class="p2">5. Emax model with interim analysis</p>
<p class="p2">6. Binary data</p>
<p class="p2">7. User-defined function for specifying mean effects for each treatment</p>
<p class="p2">8. Crossover trial</p>
<p class="p2">9. Generating more than one response outcome.</p>
<p class="p3"><br></p>
<ol class="ol1">
  <li class="li4"><b>1. Basic linear model</b></li>
</ol>
<p class="p5"><b>generateData</b><span class="s1"><b>( </b></span><b>replicateN</b><span class="s1"><b> = </b></span><span class="s2"><b>100</b></span><span class="s1"><b>, </b></span><b>subjects</b><span class="s1"><b>=</b></span><span class="s2"><b>200</b></span><span class="s1"><b>, </b></span><b>treatSubj</b><span class="s1"><b> = </b></span><b>rep</b><span class="s1"><b>(</b></span><span class="s2"><b>100</b></span><span class="s1"><b>,</b></span><span class="s2"><b>2</b></span><span class="s1"><b>),<span class="Apple-converted-space"> </span></b></span></p>
<p class="p5"><b>treatDoses</b><span class="s1"><b> = </b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>100</b></span><span class="s1"><b>),<span class="Apple-converted-space"> </span></b></span></p>
<p class="p5"><b>genParNames</b><span class="s1"><b> = </b></span><span class="s3"><b>"ALPHA, BETA"</b></span><span class="s1"><b>, </b></span><b>genParMean</b><span class="s1"><b> = </b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>1</b></span><span class="s1"><b>), </b></span><b>genParVCov</b><span class="s1"><b>=</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span></p>
<p class="p6"><span class="s4"><b>respEqn</b></span><span class="s1"><b> = </b></span><b>"ALPHA+BETA*DOSE"</b><span class="s1"><b>,<span class="Apple-converted-space">  </span></b></span><span class="s4"><b>respVCov</b></span><span class="s1"><b> = </b></span><span class="s2"><b>1</b></span><span class="s1"><b>,</b></span></p>
<p class="p7"><span class="s4"><b>seed</b></span><span class="s1"><b>=</b></span><b>12345</b><span class="s1"><b>)</b></span></p>
<p class="p8"><br></p>
<p class="p9">Generates 100 replicates of 200 subjects split equally across the two treatment arms. The treatment doses are 0 and 100. Parameters ALPHA and BETA are generated where ALPHA=0 and BETA=1. The values of ALPHA and BETA will not change between simulation replicates since<span class="s5"> genParVCov = 0</span>. The linear predictor (<b>respEqn</b>) calculates the response for each treatment (dose) according to the equation ALPHA+BETA*DOSE, in this case the expected effect at each dose is the same as the dose level since ALPHA=0 and BETA=1. respVCov specifies the response variability / residual error which will be added to the expected values generated through respEqn. Here the residual variability = 1 so values from a N(0,1) distribution will be generated for each response and added to values from respEqn. The seed is set to ensure reproducability. By default MSToolkit assumes an additive error structure, although this can be changed through settings in the <a href="file:///Users/mike/Documents/SVN/www/generatedata(...).html"><span class="s6">generateData(...)</span></a> call.</p>
<p class="p10"><br></p>
<ol class="ol1">
  <li class="li4"><b>2. Basic Emax Model</b></li>
</ol>
<p class="p5"><b>generateData</b><span class="s1"><b>( </b></span><b>replicateN</b><span class="s1"><b> = </b></span><span class="s2"><b>100</b></span><span class="s1"><b>, </b></span><b>subjects</b><span class="s1"><b>=</b></span><span class="s2"><b>100</b></span><span class="s1"><b>, </b></span><b>treatSubj</b><span class="s1"><b> = </b></span><b>rep</b><span class="s1"><b>(</b></span><span class="s2"><b>20</b></span><span class="s1"><b>,</b></span><span class="s2"><b>5</b></span><span class="s1"><b>),</b></span></p>
<p class="p11"><span class="s4"><b>treatDoses</b></span><b> = </b><span class="s4"><b>c</b></span><b>(</b><span class="s2"><b>0</b></span><b>, </b><span class="s2"><b>5</b></span><b>, </b><span class="s2"><b>10</b></span><b>, </b><span class="s2"><b>50</b></span><b>, </b><span class="s2"><b>100</b></span><b>),<span class="Apple-converted-space"> </span></b></p>
<p class="p5"><b>genParNames</b><span class="s1"><b> = </b></span><span class="s3"><b>"E0,ED50,EMAX"</b></span><span class="s1"><b>, </b></span><b>genParMean</b><span class="s1"><b> = </b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>50</b></span><span class="s1"><b>,</b></span><span class="s2"><b>100</b></span><span class="s1"><b>), </b></span><b>genParVCov</b><span class="s1"><b>=</b></span><b>diag</b><span class="s1"><b>(</b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>0</b></span><span class="s1"><b>)),</b></span></p>
<p class="p6"><span class="s4"><b>respEqn</b></span><span class="s1"><b> = </b></span><b>"E0 + ((DOSE * EMAX)/(DOSE + ED50))"</b><span class="s1"><b>,<span class="Apple-converted-space">  </span></b></span><span class="s4"><b>respVCov</b></span><span class="s1"><b> = </b></span><span class="s2"><b>100</b></span><span class="s1"><b>)</b></span></p>
<p class="p10"><br></p>
<p class="p9">This code produces 100 replicates of 100 subjects split equally across the 5 treatment arms. The treatment arms are 0,5,10,50,100. Three parameters are to be generated, and are named E0, ED50 and EMAX. These take the values 0, 50 and 100 respectively. The variance-covariance matrix is set to zero so again, these parameters will be the same across all replicates. The linear predictor is the standard 3-parameter Emax model. The variance of the response is set to 100 so responses will be drawn from a Normal distribution with mean given by the Emax model and variance 100 i.e. residual variability = 100.</p>
<p class="p10"><br></p>
<ol class="ol1">
  <li class="li4"><b>3. Emax model with variability between replicates in parameters</b></li>
</ol>
<p class="p5"><b>generateData</b><span class="s1"><b>( </b></span><b>replicateN</b><span class="s1"><b> = </b></span><span class="s2"><b>100</b></span><span class="s1"><b>, </b></span><b>subjects</b><span class="s1"><b>=</b></span><span class="s2"><b>100</b></span><span class="s1"><b>, </b></span><b>treatSubj</b><span class="s1"><b> = </b></span><b>rep</b><span class="s1"><b>(</b></span><span class="s2"><b>20</b></span><span class="s1"><b>,</b></span><span class="s2"><b>5</b></span><span class="s1"><b>),</b></span></p>
<p class="p11"><span class="s4"><b>treatDoses</b></span><b> = </b><span class="s4"><b>c</b></span><b>(</b><span class="s2"><b>0</b></span><b>, </b><span class="s2"><b>5</b></span><b>, </b><span class="s2"><b>10</b></span><b>, </b><span class="s2"><b>50</b></span><b>, </b><span class="s2"><b>100</b></span><b>),<span class="Apple-converted-space"> </span></b></p>
<p class="p5"><b>genParNames</b><span class="s1"><b> = </b></span><span class="s3"><b>"E0,ED50,EMAX"</b></span><span class="s1"><b>, </b></span><b>genParMean</b><span class="s1"><b> = </b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>50</b></span><span class="s1"><b>,</b></span><span class="s2"><b>100</b></span><span class="s1"><b>), </b></span><b>genParVCov</b><span class="s1"><b>=</b></span><b>diag</b><span class="s1"><b>(</b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>10</b></span><span class="s1"><b>,</b></span><span class="s2"><b>10</b></span><span class="s1"><b>,</b></span><span class="s2"><b>10</b></span><span class="s1"><b>)),</b></span></p>
<p class="p6"><span class="s4"><b>respEqn</b></span><span class="s1"><b> = </b></span><b>"E0 + ((DOSE * EMAX)/(DOSE + ED50))"</b><span class="s1"><b>,<span class="Apple-converted-space">  </span></b></span><span class="s4"><b>respVCov</b></span><span class="s1"><b> = </b></span><span class="s2"><b>100</b></span><span class="s1"><b>)</b></span></p>
<p class="p10"><br></p>
<p class="p9">Like example 2, this code produces 100 replicates of 100 subjects. In this case the variance-covariance matrix is set to a diagonal matrix with variance 10 for each parameter. This means that E0 ~ N(0,10); ED50 ~ N(50,10) and EMAX ~ N(100,10) and the values for E0, ED50 and EMAX for each replicate will be drawn from these Normal distributions. For more explanation of why you might vary model parameter values between replicates please read the <a href="file:///Users/mike/Documents/SVN/www/simulation%20overview.html"><span class="s6">simulation overview</span></a>.</p>
<p class="p10"><br></p>
<ol class="ol1">
  <li class="li4"><b>4. Emax model with correlation between replicates in parameters</b></li>
</ol>
<p class="p5"><b>generateData</b><span class="s1"><b>( </b></span><b>replicateN</b><span class="s1"><b> = </b></span><span class="s2"><b>100</b></span><span class="s1"><b>, </b></span><b>subjects</b><span class="s1"><b>=</b></span><span class="s2"><b>100</b></span><span class="s1"><b>, </b></span><b>treatSubj</b><span class="s1"><b> = </b></span><b>rep</b><span class="s1"><b>(</b></span><span class="s2"><b>20</b></span><span class="s1"><b>,</b></span><span class="s2"><b>5</b></span><span class="s1"><b>),</b></span></p>
<p class="p11"><span class="s4"><b>treatDoses</b></span><b> = </b><span class="s4"><b>c</b></span><b>(</b><span class="s2"><b>0</b></span><b>, </b><span class="s2"><b>5</b></span><b>, </b><span class="s2"><b>10</b></span><b>, </b><span class="s2"><b>50</b></span><b>, </b><span class="s2"><b>100</b></span><b>),<span class="Apple-converted-space"> </span></b></p>
<p class="p5"><b>genParNames</b><span class="s1"><b> = </b></span><span class="s3"><b>"E0,ED50,EMAX"</b></span><span class="s1"><b>, </b></span><b>genParMean</b><span class="s1"><b> = </b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>50</b></span><span class="s1"><b>,</b></span><span class="s2"><b>100</b></span><span class="s1"><b>), </b></span><b>genParVCov</b><span class="s1"><b>=</b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>10</b></span><span class="s1"><b>,</b></span><span class="s2"><b>1</b></span><span class="s1"><b>,</b></span><span class="s2"><b>10</b></span><span class="s1"><b>,</b></span><span class="s2"><b>1</b></span><span class="s1"><b>,</b></span><span class="s2"><b>8</b></span><span class="s1"><b>,</b></span><span class="s2"><b>10</b></span><span class="s1"><b>),</b></span></p>
<p class="p6"><span class="s4"><b>respEqn</b></span><span class="s1"><b> = </b></span><b>"E0 + ((DOSE * EMAX)/(DOSE + ED50))"</b><span class="s1"><b>,<span class="Apple-converted-space">  </span></b></span><span class="s4"><b>respVCov</b></span><span class="s1"><b> = </b></span><span class="s2"><b>100</b></span><span class="s1"><b>)</b></span></p>
<p class="p12"><br></p>
<p class="p9">In this example we include correlations between the parameters E0, ED50, EMAX. Each has variance = 10 but the correlation between ED50 and EMAX is 0.8 - typical of what we see for this type of model. Note that the variance-covariance matrix can be specified a number of ways - as an array / matrix, or here as values of the lower triangle of that full variance-covariance matrix. MSToolkit automatically converts these numbers to a full covariance matrix and checks that it is positive-semi-definite using the function parseCovMatrix.</p>
<p class="p10"><br></p>
<ol class="ol1">
  <li class="li4"><b>5. Emax model with interim analyses</b></li>
</ol>
<p class="p5"><b>generateData</b><span class="s1"><b>( </b></span><b>replicateN</b><span class="s1"><b> = </b></span><span class="s2"><b>2</b></span><span class="s1"><b>, </b></span><b>subjects</b><span class="s1"><b>=</b></span><span class="s2"><b>100</b></span><span class="s1"><b>, </b></span><b>treatSubj</b><span class="s1"><b> = </b></span><b>rep</b><span class="s1"><b>(</b></span><span class="s2"><b>20</b></span><span class="s1"><b>,</b></span><span class="s2"><b>5</b></span><span class="s1"><b>),</b></span></p>
<p class="p11"><span class="s4"><b>treatDoses</b></span><b> = </b><span class="s4"><b>c</b></span><b>(</b><span class="s2"><b>0</b></span><b>, </b><span class="s2"><b>5</b></span><b>, </b><span class="s2"><b>10</b></span><b>, </b><span class="s2"><b>50</b></span><b>, </b><span class="s2"><b>100</b></span><b>),<span class="Apple-converted-space"> </span></b></p>
<p class="p5"><b>genParNames</b><span class="s1"><b> = </b></span><span class="s3"><b>"E0,ED50,EMAX"</b></span><span class="s1"><b>, </b></span><b>genParMean</b><span class="s1"><b> = </b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>50</b></span><span class="s1"><b>,</b></span><span class="s2"><b>100</b></span><span class="s1"><b>), </b></span><b>genParVCov</b><span class="s1"><b>=</b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>10</b></span><span class="s1"><b>,</b></span><span class="s2"><b>1</b></span><span class="s1"><b>,</b></span><span class="s2"><b>10</b></span><span class="s1"><b>,</b></span><span class="s2"><b>1</b></span><span class="s1"><b>,</b></span><span class="s2"><b>8</b></span><span class="s1"><b>,</b></span><span class="s2"><b>10</b></span><span class="s1"><b>),</b></span></p>
<p class="p6"><span class="s4"><b>respEqn</b></span><span class="s1"><b> = </b></span><b>"E0 + ((DOSE * EMAX)/(DOSE + ED50))"</b><span class="s1"><b>,<span class="Apple-converted-space">  </span></b></span><span class="s4"><b>respVCov</b></span><span class="s1"><b> = </b></span><span class="s2"><b>100</b></span><span class="s1"><b>,</b></span></p>
<p class="p5"><b>interimSubj</b><span class="s1"><b>=</b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0.33</b></span><span class="s1"><b>,</b></span><span class="s2"><b>0.66</b></span><span class="s1"><b>))</b></span></p>
<p class="p12"><br></p>
<p class="p9">In this example we include the argument interimSubj which allows us to specify the proportion of subjects in each interim cut (note that the proportions are cumulative). Thus we have our first interim after 1/3 of data, the second at 2/3. Subjects are randomly assigned to interim proportions 1,2,3 with probabilty 1/3 for each. This means that there may not be <b><i>exactly</i></b> 1/3 of subjects assigned to each interim, as we would experience in real life.</p>
<p class="p13"><br></p>
<ol class="ol1">
  <li class="li4"><b>6. Binary data</b></li>
</ol>
<p class="p5"><b>generateData</b><span class="s1"><b>( </b></span><b>replicateN</b><span class="s1"><b> = </b></span><span class="s2"><b>2</b></span><span class="s1"><b>, </b></span><b>subjects</b><span class="s1"><b>=</b></span><span class="s2"><b>200</b></span><span class="s1"><b>, </b></span><b>treatSubj</b><span class="s1"><b> = </b></span><b>rep</b><span class="s1"><b>(</b></span><span class="s2"><b>100</b></span><span class="s1"><b>,</b></span><span class="s2"><b>2</b></span><span class="s1"><b>),<span class="Apple-converted-space"> </span></b></span></p>
<p class="p5"><b>treatDoses</b><span class="s1"><b> = </b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>100</b></span><span class="s1"><b>),<span class="Apple-converted-space"> </span></b></span></p>
<p class="p5"><b>genParNames</b><span class="s1"><b> = </b></span><span class="s3"><b>"ALPHA, BETA"</b></span><span class="s1"><b>, </b></span><b>genParMean</b><span class="s1"><b> = </b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>1</b></span><span class="s1"><b>), </b></span><b>genParVCov</b><span class="s1"><b>=</b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>1</b></span><span class="s1"><b>,</b></span><span class="s2"><b>1</b></span><span class="s1"><b>),</b></span></p>
<p class="p6"><span class="s4"><b>respEqn</b></span><span class="s1"><b> = </b></span><b>"ALPHA+BETA*DOSE"</b><span class="s1"><b>,<span class="Apple-converted-space">  </span></b></span><span class="s4"><b>respDist</b></span><span class="s1"><b>=</b></span><b>"Binary"</b><span class="s1"><b>,</b></span></p>
<p class="p7"><span class="s4"><b>seed</b></span><span class="s1"><b>=</b></span><b>12345</b><span class="s1"><b>)</b></span></p>
<p class="p12"><br></p>
<p class="p14">In this example we simulate data from a binomial distribution. The linear predictor is given by log(p/1-p)=ALPHA+BETA*DOSE, so that the probability of a response = 1 increases with DOSE. Again, the values of ALPHA and BETA vary between replicates. Count data can be similarly generated by setting respDist="Poisson". The canonical inverse link functions are used to convert between the linear predictor and the input to the response distribution i.e. for Binary data the link is exp( x ) / 1 + exp( x ) while for Count data the link is exp( x ). Other link functions can be specified by setting the argument respInvLink which takes any R function. For example it is possible to generate binary data from explicit probabilities by setting respDist = "Binary" and respInvLink = "NULL" to use the identity link.</p>
<p class="p13"><br></p>
<ol class="ol1">
  <li class="li4"><b>7. User-defined function for specifying mean effects for each treatment</b></li>
</ol>
<p class="p5"><b>resp.fn</b><span class="s1"><b>&lt;-</b></span><span class="s7"><b>function</b></span><span class="s1"><b>(</b></span><b>data</b><span class="s1"><b>){</b></span></p>
<p class="p5"><span class="s1"><b><span class="Apple-tab-span">	</span></b></span><b>RESP</b><span class="s1"><b>&lt;-</b></span><b>rep</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><b>nrow</b><span class="s1"><b>(</b></span><b>data</b><span class="s1"><b>))</b></span></p>
<p class="p5"><span class="s1"><b><span class="Apple-tab-span">	</span></b></span><b>RESP</b><span class="s1"><b>[</b></span><b>data</b><span class="s1"><b>$</b></span><b>TRT</b><span class="s1"><b>==</b></span><span class="s2"><b>1</b></span><span class="s1"><b>]&lt;-</b></span><b>data</b><span class="s1"><b>$</b></span><b>MEAN1</b><span class="s1"><b>[</b></span><b>data</b><span class="s1"><b>$</b></span><b>TRT</b><span class="s1"><b>==</b></span><span class="s2"><b>1</b></span><span class="s1"><b>]</b></span></p>
<p class="p5"><span class="s1"><b><span class="Apple-tab-span">	</span></b></span><b>RESP</b><span class="s1"><b>[</b></span><b>data</b><span class="s1"><b>$</b></span><b>TRT</b><span class="s1"><b>==</b></span><span class="s2"><b>2</b></span><span class="s1"><b>]&lt;-</b></span><b>data</b><span class="s1"><b>$</b></span><b>MEAN2</b><span class="s1"><b>[</b></span><b>data</b><span class="s1"><b>$</b></span><b>TRT</b><span class="s1"><b>==</b></span><span class="s2"><b>2</b></span><span class="s1"><b>]</b></span></p>
<p class="p5"><span class="s1"><b><span class="Apple-tab-span">	</span></b></span><b>RESP</b></p>
<p class="p11"><b><span class="Apple-tab-span">	</span>}</b></p>
<p class="p5"><b>generateData</b><span class="s1"><b>( </b></span><b>replicateN</b><span class="s1"><b> = </b></span><span class="s2"><b>2</b></span><span class="s1"><b>, </b></span><b>subjects</b><span class="s1"><b>=</b></span><span class="s2"><b>200</b></span><span class="s1"><b>, </b></span><b>treatSubj</b><span class="s1"><b> = </b></span><b>rep</b><span class="s1"><b>(</b></span><span class="s2"><b>100</b></span><span class="s1"><b>,</b></span><span class="s2"><b>2</b></span><span class="s1"><b>),<span class="Apple-converted-space"> </span></b></span></p>
<p class="p5"><b>treatDoses</b><span class="s1"><b> = </b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>1</b></span><span class="s1"><b>),<span class="Apple-converted-space"> </span></b></span></p>
<p class="p5"><b>genParNames</b><span class="s1"><b> = </b></span><span class="s3"><b>"MEAN1, MEAN2"</b></span><span class="s1"><b>, </b></span><b>genParMean</b><span class="s1"><b> = </b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>10</b></span><span class="s1"><b>), </b></span><b>genParVCov</b><span class="s1"><b>=</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span></p>
<p class="p5"><b>respEqn</b><span class="s1"><b> = </b></span><b>resp.fn</b><span class="s1"><b>, </b></span><b>respVCov</b><span class="s1"><b>=</b></span><span class="s2"><b>1</b></span><span class="s1"><b>,</b></span></p>
<p class="p7"><span class="s4"><b>seed</b></span><span class="s1"><b>=</b></span><b>12345</b><span class="s1"><b>)</b></span></p>
<p class="p12"><br></p>
<p class="p14">Here we want to precisely what the mean response will be for two different treatments (say an experimental drug and a control treatment). We have written a function called resp.fn which calculates the mean response for each subject which takes the data with treatment identifier (TRT=1 or 2), DOSE information (here DOSE=0 or 1, but these are merely labels and can be ignored in this example). The dataset also includes two parameters - MEAN1 and MEAN2 which have values 0 and 10 respectively. resp.fn must take this dataset and return a value of RESP for each subject. So the function initialises a value for RESP (=0) and then for each treatment, assigns MEAN=1 where TRT=1 and MEAN=10 where TRT=2.<span class="Apple-converted-space">  </span>The resulting values then have residual error add (respVCov=1).</p>
<p class="p12"><br></p>
<p class="p12"><br></p>
<ol class="ol1">
  <li class="li4"><b>8. Generating data from a crossover trial.</b></li>
</ol>
<p class="p5"><b>resp.fn</b><span class="s1"><b>&lt;-</b></span><span class="s7"><b>function</b></span><span class="s1"><b>(</b></span><b>data</b><span class="s1"><b>){</b></span></p>
<p class="p5"><span class="s1"><b><span class="Apple-tab-span">	</span></b></span><b>RESP</b><span class="s1"><b>&lt;-</b></span><b>rep</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><b>nrow</b><span class="s1"><b>(</b></span><b>data</b><span class="s1"><b>))</b></span></p>
<p class="p5"><span class="s1"><b><span class="Apple-tab-span">	</span></b></span><b>RESP</b><span class="s1"><b>[</b></span><b>data</b><span class="s1"><b>$</b></span><b>DOSE</b><span class="s1"><b>==</b></span><span class="s2"><b>0</b></span><span class="s1"><b>]&lt;-</b></span><b>data</b><span class="s1"><b>$</b></span><b>MEAN1</b><span class="s1"><b>[</b></span><b>data</b><span class="s1"><b>$</b></span><b>DOSE </b><span class="s1"><b>==</b></span><span class="s2"><b>0</b></span><span class="s1"><b>]</b></span></p>
<p class="p5"><span class="s1"><b><span class="Apple-tab-span">	</span></b></span><b>RESP</b><span class="s1"><b>[</b></span><b>data</b><span class="s1"><b>$</b></span><b>DOSE </b><span class="s1"><b>==</b></span><span class="s2"><b>1</b></span><span class="s1"><b>]&lt;-</b></span><b>data</b><span class="s1"><b>$</b></span><b>MEAN2</b><span class="s1"><b>[</b></span><b>data</b><span class="s1"><b>$</b></span><b>DOSE </b><span class="s1"><b>==</b></span><span class="s2"><b>1</b></span><span class="s1"><b>]</b></span></p>
<p class="p5"><span class="s1"><b><span class="Apple-tab-span">	</span></b></span><b>RESP</b></p>
<p class="p11"><b><span class="Apple-tab-span">	</span>}</b></p>
<p class="p5"><b>generateData</b><span class="s1"><b>( </b></span><b>replicateN</b><span class="s1"><b> = </b></span><span class="s2"><b>2</b></span><span class="s1"><b>, </b></span><b>subjects</b><span class="s1"><b>=</b></span><span class="s2"><b>20</b></span><span class="s1"><b>, </b></span><b>treatSubj</b><span class="s1"><b> = </b></span><b>rep</b><span class="s1"><b>(</b></span><span class="s2"><b>10</b></span><span class="s1"><b>,</b></span><span class="s2"><b>2</b></span><span class="s1"><b>), </b></span><b>treatDoses</b><span class="s1"><b> = </b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>1</b></span><span class="s1"><b>),</b></span></p>
<p class="p5"><b>treatType</b><span class="s1"><b>=</b></span><span class="s3"><b>"Crossover"</b></span><span class="s1"><b>, </b></span><b>treatSeq</b><span class="s1"><b>=</b></span><b>array</b><span class="s1"><b>(</b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>1</b></span><span class="s1"><b>,</b></span><span class="s2"><b>1</b></span><span class="s1"><b>,</b></span><span class="s2"><b>0</b></span><span class="s1"><b>),</b></span><b>dim</b><span class="s1"><b>=</b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>2</b></span><span class="s1"><b>,</b></span><span class="s2"><b>2</b></span><span class="s1"><b>)),</b></span></p>
<p class="p5"><b>genParNames</b><span class="s1"><b> = </b></span><span class="s3"><b>"MEAN1, MEAN2"</b></span><span class="s1"><b>, </b></span><b>genParMean</b><span class="s1"><b> = </b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span><span class="s2"><b>10</b></span><span class="s1"><b>), </b></span><b>genParVCov</b><span class="s1"><b>=</b></span><span class="s2"><b>0</b></span><span class="s1"><b>,</b></span></p>
<p class="p5"><b>genParBtwNames</b><span class="s1"><b>=</b></span><span class="s3"><b>"MEAN1,MEAN2"</b></span><span class="s1"><b>,</b></span><b>genParBtwVCov</b><span class="s1"><b>=</b></span><b>c</b><span class="s1"><b>(</b></span><span class="s2"><b>1</b></span><span class="s1"><b>,0.8,</b></span><span class="s2"><b>1</b></span><span class="s1"><b>),</b></span><b>genParErrStruc</b><span class="s1"><b>=</b></span><span class="s3"><b>"Additive"</b></span><span class="s1"><b>,</b></span></p>
<p class="p5"><b>respEqn</b><span class="s1"><b> = </b></span><b>resp.fn</b><span class="s1"><b>, </b></span><b>respVCov</b><span class="s1"><b>=</b></span><span class="s2"><b>1</b></span><span class="s1"><b>,</b></span></p>
<p class="p7"><span class="s4"><b>seed</b></span><span class="s1"><b>=</b></span><b>12345</b><span class="s1"><b>)</b></span></p>
<p class="p12"><br></p>
<p class="p14">Here we use the same function as above to generate the mean response for each subject, however we have specified that we want to generate data for a crossover trial. Note that here we swap from specifying RESP as a function of TRT into RESP as a function of DOSE. This is because when we specify a crossover trial, TRT becomes the treatment sequence that subjects are allocated to, so DOSE becomes the treatment identifier for each period. This could be a dose of drug, or simply a label (since the means here are defined exactly for each treatment). We use the argument treatType to show that we are generating data for a crossover trial and we use treatSeq to define the treatment sequences. treatSeq should be an array, but can specify any number of treatment periods and sequences using the labels for treatments given by treatDoses - here 0 and 1. The array has sequences as columns and periods as rows. Here we have specified a 2x2 crossover with two sequences - DOSE=0 followed by DOSE=1 and vice versa. A three-period, two-treatment design could be specified as treatSeq<span class="s1">=</span>array<span class="s1">(</span>c<span class="s1">(</span><span class="s2">0</span><span class="s1">,</span><span class="s2">1</span><span class="s1">,</span><span class="s2">1</span><span class="s1">,</span><span class="s2">1</span><span class="s1">,</span><span class="s2">0</span><span class="s1">,</span><span class="s2">0</span><span class="s1">),</span>dim<span class="s1">=</span>c<span class="s1">(</span><span class="s2">3</span><span class="s1">,</span><span class="s2">2</span><span class="s1">))</span><span class="s8"><b>.</b></span></p>
<p class="p12"><br></p>
<p class="p14">We must also take a little extra care in thinking about the data generation processes in crossover trials. In a crossover we can assume that the treatment effect is constant across treatment periods, but we usually assume that an individual's responses between periods is correlated - that is subjects with high observations in period 1 will have high observations in period 2. We do this by specifying <b>between subject variability </b>in the parameter means through genParBtwNames, genParBtwParVCov and genParErrStruc. These options add between subject variability to MEAN1 and MEAN2 with a correlation of 0.8 between them. Thus subjects with high MEAN1 will also have high MEAN2. Finally the residual error is added through respVCov as usual. Then, in the analysis, we will look for treatment effects <b>within</b> subjects and we can also look at period effects and sequence effects (none simulated here).</p>
<p class="p13"><br></p>
<ol class="ol1">
  <li class="li4"><b>9. Generating more than one response outcome.</b><span class="Apple-converted-space">  </span><span class="s9">(e.g. Generating efficacy and safety data).</span></li>
</ol>
<p class="p14">This can be achieved by using two generateData steps with two separate working directories (use setwd(...) to set the working directory in R). When generating parameters for the efficacy and safety models, it may be advantageous to generate the full set of parameters for both models within each generateData step i.e. generate safety parameters within the efficacy generateData step and vice versa. If the same seed is used in both steps then the parameters across the two generateData steps will have the same parameter values. Merging the replicate000x.csv datasets together will then create data with the two response variables properly correlated. Below is some example code for this:</p>
<p class="p15"><br></p>
<p class="p5"><b>### Set the working directory to point to the “Efficacy” directory (must already exist).</b></p>
<p class="p16"><span class="s4"><b>setwd</b></span><span class="s10"><b>(</b></span><b>“../efficacy”</b><span class="s10"><b>)</b></span></p>
<p class="p5"><b>generateData</b><span class="s10"><b>(</b></span><b>rep</b><span class="s10"><b>=</b></span><span class="s11"><b>2</b></span><span class="s10"><b>,</b></span><b>subj</b><span class="s10"><b>=</b></span><span class="s11"><b>10</b></span><span class="s10"><b>,</b></span><b>treatDoses</b><span class="s10"><b>=</b></span><b>c</b><span class="s10"><b>(</b></span><span class="s11"><b>0</b></span><span class="s10"><b>,</b></span><span class="s11"><b>10</b></span><span class="s10"><b>),</b></span><b>genParNames</b><span class="s10"><b>=</b></span><span class="s12"><b>"EFFMEAN,SAFEMEAN"</b></span><span class="s10"><b>, </b></span><b>genParMean</b><span class="s10"><b>=</b></span><b>c</b><span class="s10"><b>(</b></span><span class="s11"><b>10</b></span><span class="s10"><b>,</b></span><span class="s11"><b>20</b></span><span class="s10"><b>),</b></span></p>
<p class="p5"><b>genParVCov</b><span class="s10"><b>=</b></span><b>c</b><span class="s10"><b>(</b></span><span class="s11"><b>0</b></span><span class="s10"><b>,</b></span><span class="s11"><b>1</b></span><span class="s10"><b>),</b></span><b>respEqn</b><span class="s10"><b>=</b></span><span class="s12"><b>"EFFMEAN"</b></span><span class="s10"><b>,</b></span><b>seed</b><span class="s10"><b>=</b></span><span class="s11"><b>123</b></span><span class="s10"><b>)</b></span></p>
<p class="p17"><br></p>
<p class="p16"><span class="s4"><b>setwd</b></span><span class="s10"><b>(</b></span><b>"../safety"</b><span class="s10"><b>)</b></span></p>
<p class="p5"><b>generateData</b><span class="s10"><b>(</b></span><b>rep</b><span class="s10"><b>=</b></span><span class="s11"><b>2</b></span><span class="s10"><b>,</b></span><b>subj</b><span class="s10"><b>=</b></span><span class="s11"><b>10</b></span><span class="s10"><b>,</b></span><b>treatDoses</b><span class="s10"><b>=</b></span><b>c</b><span class="s10"><b>(</b></span><span class="s11"><b>0</b></span><span class="s10"><b>,</b></span><span class="s11"><b>10</b></span><span class="s10"><b>),</b></span><b>genParNames</b><span class="s10"><b>=</b></span><span class="s12"><b>"EFFMEAN,SAFEMEAN"</b></span><span class="s10"><b>, </b></span><b>genParMean</b><span class="s10"><b>=</b></span><b>c</b><span class="s10"><b>(</b></span><span class="s11"><b>10</b></span><span class="s10"><b>,</b></span><span class="s11"><b>20</b></span><span class="s10"><b>),</b></span></p>
<p class="p5"><b>genParVCov</b><span class="s10"><b>=</b></span><b>c</b><span class="s10"><b>(</b></span><span class="s11"><b>0</b></span><span class="s10"><b>,</b></span><span class="s11"><b>1</b></span><span class="s10"><b>),</b></span><b>respEqn</b><span class="s10"><b>=</b></span><span class="s12"><b>"SAFEMEAN"</b></span><span class="s10"><b>,</b></span><b>seed</b><span class="s10"><b>=</b></span><span class="s11"><b>123</b></span><span class="s10"><b>)</b></span></p>
<p class="p17"><br></p>
<p class="p16"><span class="s4"><b>eff</b></span><span class="s10"><b>&lt;-</b></span><span class="s4"><b>readAllData</b></span><span class="s10"><b>(</b></span><b>"ReplicateData"</b><span class="s10"><b>,</b></span><span class="s4"><b>workingPath</b></span><span class="s10"><b>=</b></span><b>"../efficacy"</b><span class="s10"><b>)</b></span></p>
<p class="p5"><b>eff</b><span class="s10"><b>$</b></span><b>EFF</b><span class="s10"><b>&lt;-</b></span><b>eff</b><span class="s10"><b>$</b></span><b>RESP</b></p>
<p class="p16"><span class="s4"><b>eff</b></span><span class="s10"><b>&lt;-</b></span><span class="s4"><b>eff</b></span><span class="s10"><b>[,</b></span><span class="s4"><b>c</b></span><span class="s10"><b>(</b></span><b>"Replicate"</b><span class="s10"><b>,</b></span><b>"SUBJ"</b><span class="s10"><b>,</b></span><b>"TRT"</b><span class="s10"><b>,</b></span><b>"DOSE"</b><span class="s10"><b>,</b></span><b>"EFFMEAN"</b><span class="s10"><b>,</b></span><b>"SAFEMEAN"</b><span class="s10"><b>,</b></span><b>"EFF"</b><span class="s10"><b>)]</b></span></p>
<p class="p17"><br></p>
<p class="p5"><b>safety</b><span class="s10"><b>&lt;-</b></span><b>readAllData</b><span class="s10"><b>(</b></span><span class="s12"><b>"ReplicateData"</b></span><span class="s10"><b>,</b></span><b>workingPath</b><span class="s10"><b>=</b></span><span class="s12"><b>"../safety"</b></span><span class="s10"><b>)</b></span></p>
<p class="p5"><b>safety</b><span class="s10"><b>$</b></span><b>SAFETY</b><span class="s10"><b>&lt;-</b></span><b>safety</b><span class="s10"><b>$</b></span><b>RESP</b></p>
<p class="p16"><span class="s4"><b>safety</b></span><span class="s10"><b>&lt;-</b></span><span class="s4"><b>safety</b></span><span class="s10"><b>[,</b></span><span class="s4"><b>c</b></span><span class="s10"><b>(</b></span><b>"Replicate"</b><span class="s10"><b>,</b></span><b>"SUBJ"</b><span class="s10"><b>,</b></span><b>"TRT"</b><span class="s10"><b>,</b></span><b>"DOSE"</b><span class="s10"><b>,</b></span><b>"EFFMEAN"</b><span class="s10"><b>,</b></span><b>"SAFEMEAN"</b><span class="s10"><b>,</b></span><b>"SAFETY"</b><span class="s10"><b>)]</b></span></p>
<p class="p5"><b>data</b><span class="s10"><b>&lt;-</b></span><b>merge</b><span class="s10"><b>(</b></span><b>eff</b><span class="s10"><b>,</b></span><b>safety</b><span class="s10"><b>)</b></span></p>
<p class="p17"><br></p>
<p class="p5"><b>writeData</b><span class="s10"><b>(</b></span><b>data</b><span class="s10"><b>,</b></span><b>max</b><span class="s10"><b>(</b></span><b>data</b><span class="s10"><b>$</b></span><b>Replicate</b><span class="s10"><b>),</b></span><b>dataType</b><span class="s10"><b>=</b></span><span class="s12"><b>"ReplicateData"</b></span><span class="s10"><b>,</b></span><b>workingPath</b><span class="s10"><b>=</b></span><span class="s12"><b>"../"</b></span><span class="s10"><b>)</b></span></p>
</body>
</html>
